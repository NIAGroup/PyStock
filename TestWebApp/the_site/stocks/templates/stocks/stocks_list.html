{% load static from staticfiles %}

<!DOCTYPE>
<html>
    <head>
        <meta charset="utf-8">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>

        <!--
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js">
      -->
        <title>Stocks</title>
        <link rel="stylesheet" href="{% static 'styles.css' %}">
    </head>
    <body>
        <h1>Stocks List</h1>

        <p></p>
        <form class="site-form" action="/stocks/addstocks" method="post">
          {% csrf_token %}
          {{form_A}}
          <input type="submit" value="Add Stock">
        </form>
        <form id="plot-form" class="site-form" method="get">
          {% csrf_token %}
          {{form_B}}
          <input type="submit" id="the_input1">
        </form>

          <div class="container" style="height:40%; width:80%">
            <canvas class="main_chart" id="myChart"></canvas>
          </div>

          <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
          <script src="https://cdn.jsdelivr.net/npm/jquery.marquee@1.5.0/jquery.marquee.min.js"></script>
          <script name='runjs' type='text/javascript'>
            {% block jquery %}
            var stockChart = null
            function plotFxn(endpoint,chart_labels,chart_data,chart_name,myform){
              $.ajax({
                method: "GET",
                url: 'getData',
                data:myform.serialize(),
                success: function(data){
                  console.log(data)
                  chart_labels = data.dates
                  chart_data = data.values
                  chart_name = data.stock_name
                  Chart.defaults.global.defaultFontColor = 'white'
                  canvas = document.getElementById('myChart');
                  var myChart = canvas.getContext('2d');
                  if (stockChart!=null){
                    stockChart.destroy()
                    console.log("I DESTROYED YOUR OLD CHART!")
                  }
                  stockChart = new Chart(myChart, {
                    type:'line',
                    data:{
                      labels:chart_labels,
                      datasets:[{
                        label:chart_name,
                        data:chart_data,
                        borderColor:'#32CD32',
                        fill:false,
                        pointRadius: 0,
                      }],
                    },
                    options:{
                      responive: false,
                      maintainAspectRatio: false,
                      legend:{
                        label:{
                          fontColor:'white',
                        },
                      },
                      //fill:false,
                    },
                  })
                },
              });
            }
            $('#plot-form').on('submit',function(event){
              event.preventDefault();
              var endpoint = 'getData'
              var chart_labels = []
              var chart_data = []
              var chart_name = ""
              var myform = $('#plot-form')
              plotFxn(endpoint,chart_labels,chart_data,chart_name,myform)
            });


            var endpoint = 'getData'
            var chart_labels = []
            var chart_data = []
            var chart_name = ""
            var myform = $('#plot-form')
            plotFxn(endpoint,chart_labels,chart_data,chart_name,myform)




          {% endblock %}
          </script>
        <div class='sidenav'>
          <table style="{% static 'styles.css' %}">
            {% for stock in Stocks %}
              <tr style="{% static 'styles.css' %}">
                  <th style="{% static 'styles.css' %}">{{stock.stock_name}} : {{stock.stock_symbol}}</th>
                  <!--<td><h3 style="text-align: right">{{stock.stock_symbol}}</h3></td>
                  -->
              </tr>
            {% endfor %}
          </table>
        </div>
        <!--<div class="Stock Names">
            {% for stock in Stocks %}
            <h3><a href="#">{{stock.stock_name}} : {{stock.stock_symbol}}</a></h3>
            <p>Add Date: {{stock.dates}}</p>
            {% endfor %}
        </div>-->
    </body>
</html>
