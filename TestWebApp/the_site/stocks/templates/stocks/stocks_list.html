{% load static from staticfiles %}

<!DOCTYPE>
<html>
    <head>
        <meta charset="utf-8">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>

        <!--
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js">
      -->
        <title>Stocks</title>
        <link rel="stylesheet" href="{% static 'styles.css' %}">
    </head>
    <body>
        <h1>Stocks List</h1>

        <p></p>
        <form class="site-form" action="/stocks/addstocks" method="post">
          {% csrf_token %}
          {{form_A}}
          <input type="submit" value="Add Stock">
        </form>
        <form class="site-form" action="/stocks/getData" method="post">
          {% csrf_token %}
          {{form_B}}
          <input type='submit' value="Plot Stock">
        </form>
          <div class="container" style="height:40%; width:80%">
            <canvas class="main_chart" id="myChart"></canvas>
          </div>

          <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
          <script src="https://cdn.jsdelivr.net/npm/jquery.marquee@1.5.0/jquery.marquee.min.js"></script>
          <script type='text/javascript'>
            {% block jquery %}
              var endpoint = 'getData'
              var chart_labels = []
              var chart_data = []
              var chart_name = ""
              $.ajax({
                method: "GET",
                url: endpoint,
                success: function(data){
                  console.log("success")
                  console.log(data.dates)
                  chart_labels = data.dates
                  chart_data = data.values
                  chart_name = data.stock_name
                  var myChart = document.getElementById('myChart').getContext('2d');

                  let stockChart = new Chart(myChart, {
                    type:'line',

                    data:{
                      labels:chart_labels,
                      datasets:[{
                        label:chart_name,
                        data:chart_data,
                        backgroundColor:'green',
                        pointRadius: 3,
                      }],
                    },
                  })
                },
                error: function(error_data){
                  console.log("error")
                  console.log(error_data);
                }
              })

            Chart.defaults.global.defaultFontColor = 'white';
            var myChart = document.getElementById('myChart').getContext('2d');

            let stockChart = new Chart(myChart, {
              type:'line',

              data:{
                labels:chart_labels,
                datasets:[{
                  label:'count',
                  data:chart_data,
                  backgroundColor:'green',
                  pointRadius: 3,
                }],
              },
              options:{
                responive: false,
                maintainAspectRatio: false,
                //fill:false,
              },

            });

          {% endblock %}
          </script>
        <div class='sidenav'>
          <table style="{% static 'styles.css' %}">
            {% for stock in Stocks %}
              <tr style="{% static 'styles.css' %}">
                  <th style="{% static 'styles.css' %}">{{stock.stock_name}} : {{stock.stock_symbol}}</th>
                  <!--<td><h3 style="text-align: right">{{stock.stock_symbol}}</h3></td>
                  -->
              </tr>
            {% endfor %}
          </table>
        </div>
        <!--<div class="Stock Names">
            {% for stock in Stocks %}
            <h3><a href="#">{{stock.stock_name}} : {{stock.stock_symbol}}</a></h3>
            <p>Add Date: {{stock.dates}}</p>
            {% endfor %}
        </div>-->
    </body>
</html>
